<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>A Voxel Christmas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        /* Instant splash screen - shows before CSS loads */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(5, 5, 16, 0.95) 0%, rgba(20, 30, 50, 0.98) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            visibility: visible;
        }
        body {
            margin: 0;
            overflow: hidden;
            background-color: #050510;
            background: linear-gradient(135deg, rgba(5, 5, 16, 0.95) 0%, rgba(20, 30, 50, 0.98) 100%);
        }
        canvas {
            /* Canvas will be hidden by JavaScript after scene setup, but initially visible for rendering */
            display: block;
        }
        #splash-content {
            opacity: 0;
            animation: fadeInUp 0.8s ease 0.2s forwards;
        }
    </style>
    <link rel="stylesheet" href="css/style.css">
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.181.2/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.181.2/examples/jsm/"
            }
        }
    </script>
    <script>
        // Suppress expected Tone.js AudioContext warnings BEFORE Tone.js loads
        // 
        // NOTE: Some browser-level warnings may still appear in the console. These are EXPECTED and HARMLESS:
        // - "AudioContext was not allowed to start" - Browser security requires user interaction to start audio
        // - "ScriptProcessorNode is deprecated" - Internal Tone.js deprecation warning (harmless)
        // 
        // These warnings occur because browsers require user interaction to start audio, which is a security feature.
        // We properly handle this by calling Tone.start() after user interaction (when entering first-person mode).
        // The ambient wind sound will work correctly - these are just informational browser messages.
        //
        (function() {
            const originalWarn = console.warn;
            const originalError = console.error;
            
            // Filter AudioContext warnings
            console.warn = function(...args) {
                const message = args.join(' ');
                if (message.includes('AudioContext was not allowed to start') ||
                    message.includes('must be resumed (or created) after a user gesture') ||
                    message.includes('ScriptProcessorNode is deprecated')) {
                    // Suppress expected warnings - we handle audio context properly after user interaction
                    return;
                }
                originalWarn.apply(console, args);
            };
            
            // Also filter errors that are actually just warnings
            console.error = function(...args) {
                const message = args.join(' ');
                if (message.includes('AudioContext was not allowed to start') ||
                    message.includes('must be resumed (or created) after a user gesture')) {
                    // Suppress expected errors that are actually warnings
                    return;
                }
                originalError.apply(console, args);
            };
        })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.js"></script>
    </head>

<body>

    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen-visible">
        <div class="splash-content">
            <div class="splash-header">
                <h2>‚ùÑÔ∏è A Voxel Christmas ‚ùÑÔ∏è</h2>
                <p class="splash-subtitle">v0.0.1 ALPHA</p>
            </div>
            <div class="splash-message">
                <p class="splash-greeting">Hello, and welcome!</p>
                <p>This is a labor of love - a procedural winter wonderland built with passion and pixels.</p>
                <p>You're experiencing an <strong>alpha build</strong>, so things might be a bit rough around the edges, but I hope you enjoy the magic I've tried to create.</p>
                <p class="splash-signature">With warmth and winter wishes,<br><strong>Ryan</strong> - The Dev ‚ùÑÔ∏è</p>
            </div>
            <button id="splash-continue" class="splash-button">Continue to Experience</button>
            <p class="splash-note">Click anywhere to begin</p>
        </div>
    </div>

    <div id="title-screen">
        <h1>A VOXEL CHRISTMAS</h1>
        <p>Procedural Winter Wonderland</p>

        <div class="menu-container">
            <button class="menu-btn" id="play-btn">Play</button>
            <button class="menu-btn" id="gallery-btn">Gallery</button>
            <button class="menu-btn" id="settings-btn">Settings</button>
            <button class="menu-btn">About</button>
        </div>

        <!-- World Generation Panel -->
        <div id="world-gen-panel" class="world-gen-panel-hidden">
            <div class="world-gen-header">
                <h2>üå≤ World Generation</h2>
                <button id="close-world-gen" class="close-btn">√ó</button>
            </div>
            <div class="world-gen-content">
                <div class="world-gen-status">
                    <div class="status-item">
                        <span class="status-label">World Size:</span>
                        <span class="status-value">64 x 64</span>
                    </div>
                </div>
                <div class="world-gen-toggles">
                    <div class="toggle-item">
                        <span class="toggle-label">Trees</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-trees" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-item">
                        <span class="toggle-label">Christmas Lights</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-lights" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-item">
                        <span class="toggle-label">House</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-house" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-item">
                        <span class="toggle-label">Hills</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggle-hills" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <button id="generate-world-btn" class="generate-world-btn">Generate World</button>
            </div>
        </div>

        <!-- Gallery Panel -->
        <div id="gallery-panel" class="gallery-panel-hidden">
            <div class="gallery-header">
                <h2>üñºÔ∏è Gallery</h2>
                <button id="close-gallery" class="close-btn">√ó</button>
            </div>
            <div class="gallery-tabs">
                <button class="gallery-tab active" data-tab="entities">Entities</button>
                <button class="gallery-tab" data-tab="blocks">Blocks</button>
                <button class="gallery-tab" data-tab="structures">Structures</button>
                <button class="gallery-tab" data-tab="plants">Plants</button>
            </div>
            <div class="gallery-content">
                <!-- Entities Tab -->
                <div class="gallery-tab-content active" id="gallery-entities">
                    <div class="gallery-grid">
                        <div class="gallery-item">
                            <div class="gallery-item-icon">üí°</div>
                            <div class="gallery-item-name">Christmas Light</div>
                            <div class="gallery-item-desc">Glowing holiday decoration</div>
                        </div>
                        <div class="gallery-item">
                            <div class="gallery-item-icon">‚ú®</div>
                            <div class="gallery-item-name">Tree Light</div>
                            <div class="gallery-item-desc">Colorful tree decoration</div>
                        </div>
                    </div>
                </div>

                <!-- Blocks Tab -->
                <div class="gallery-tab-content" id="gallery-blocks">
                    <div class="gallery-grid">
                        <div class="gallery-item">
                            <div class="gallery-item-icon">‚ùÑÔ∏è</div>
                            <div class="gallery-item-name">Snow Block</div>
                            <div class="gallery-item-desc">Pure white snow</div>
                        </div>
                        <div class="gallery-item">
                            <div class="gallery-item-icon">üåç</div>
                            <div class="gallery-item-name">Dirt Block</div>
                            <div class="gallery-item-desc">Earth terrain block</div>
                        </div>
                        <div class="gallery-item">
                            <div class="gallery-item-icon">ü™µ</div>
                            <div class="gallery-item-name">Wood Block</div>
                            <div class="gallery-item-desc">Tree trunk material</div>
                        </div>
                        <div class="gallery-item">
                            <div class="gallery-item-icon">üçÉ</div>
                            <div class="gallery-item-name">Leaves Block</div>
                            <div class="gallery-item-desc">Green foliage block</div>
                        </div>
                        <div class="gallery-item">
                            <div class="gallery-item-icon">ü™®</div>
                            <div class="gallery-item-name">Stone Block</div>
                            <div class="gallery-item-desc">Gray stone material</div>
                        </div>
                        <div class="gallery-item">
                            <div class="gallery-item-icon">ü™µ</div>
                            <div class="gallery-item-name">Plank Block</div>
                            <div class="gallery-item-desc">Processed wood plank</div>
                        </div>
                        <div class="gallery-item">
                            <div class="gallery-item-icon">ü™ü</div>
                            <div class="gallery-item-name">Window Block</div>
                            <div class="gallery-item-desc">Glowing window pane</div>
                        </div>
                    </div>
                </div>

                <!-- Structures Tab -->
                <div class="gallery-tab-content" id="gallery-structures">
                    <div class="gallery-grid">
                        <div class="gallery-item">
                            <div class="gallery-item-icon">üè†</div>
                            <div class="gallery-item-name">House</div>
                            <div class="gallery-item-desc">Cozy winter cottage with glowing windows</div>
                        </div>
                    </div>
                </div>

                <!-- Plants Tab -->
                <div class="gallery-tab-content" id="gallery-plants">
                    <div class="gallery-grid">
                        <div class="gallery-item">
                            <div class="gallery-item-icon">üå≤</div>
                            <div class="gallery-item-name">Christmas Tree</div>
                            <div class="gallery-item-desc">Evergreen tree with lights</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel-hidden">
            <div class="settings-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button id="close-settings" class="close-btn">√ó</button>
            </div>
            <div class="settings-tabs">
                <button class="settings-tab active" data-tab="audio">üéµ Audio</button>
                <button class="settings-tab" data-tab="controls">‚å®Ô∏è Controls</button>
                <button class="settings-tab" data-tab="video">üé¨ Video</button>
            </div>
            <div class="settings-content">
                <!-- Audio Panel -->
                <div class="settings-tab-content active" id="tab-audio">
                    <div class="audio-controls">
                        <!-- Master Audio Control -->
                        <div class="audio-control-item">
                            <div class="audio-control-header">
                                <span class="audio-control-label">Master Audio</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggle-master-audio" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="volume-slider-container">
                                <div class="volume-slider" id="master-volume-slider">
                                    <div class="volume-slider-track">
                                        <div class="volume-slider-fill" id="master-volume-fill"></div>
                                        <div class="volume-slider-handle" id="master-volume-handle"></div>
                                    </div>
                                </div>
                                <span class="volume-percentage" id="master-volume-percentage">100%</span>
                            </div>
                        </div>

                        <!-- Background Music Control -->
                        <div class="audio-control-item">
                            <div class="audio-control-header">
                                <span class="audio-control-label">Background Music</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggle-music" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="volume-slider-container">
                                <div class="volume-slider" id="music-volume-slider">
                                    <div class="volume-slider-track">
                                        <div class="volume-slider-fill" id="music-volume-fill"></div>
                                        <div class="volume-slider-handle" id="music-volume-handle"></div>
                                    </div>
                                </div>
                                <span class="volume-percentage" id="music-volume-percentage">100%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Controls Panel -->
                <div class="settings-tab-content" id="tab-controls">
                    <div class="keybind-list">
                        <div class="keybind-item" data-keybind="forward">
                            <span class="keybind-label">Move Forward</span>
                            <span class="keybind-key">W</span>
                        </div>
                        <div class="keybind-item" data-keybind="backward">
                            <span class="keybind-label">Move Backward</span>
                            <span class="keybind-key">S</span>
                        </div>
                        <div class="keybind-item" data-keybind="left">
                            <span class="keybind-label">Move Left</span>
                            <span class="keybind-key">A</span>
                        </div>
                        <div class="keybind-item" data-keybind="right">
                            <span class="keybind-label">Move Right</span>
                            <span class="keybind-key">D</span>
                        </div>
                        <div class="keybind-item" data-keybind="jump">
                            <span class="keybind-label">Jump</span>
                            <span class="keybind-key">Space</span>
                        </div>
                        <div class="keybind-item">
                            <span class="keybind-label">Look Around</span>
                            <span class="keybind-key">Mouse</span>
                        </div>
                        <div class="keybind-item">
                            <span class="keybind-label">Show/Hide UI</span>
                            <span class="keybind-key">Double Click</span>
                        </div>
                    </div>
                </div>

                <!-- Video Panel -->
                <div class="settings-tab-content" id="tab-video">
                    <div class="video-controls">
                        <!-- Performance Preset -->
                        <div class="video-control-item">
                            <div class="video-control-header">
                                <span class="video-control-label">Performance Preset</span>
                            </div>
                            <select id="performance-preset" class="preset-select">
                                <option value="low">Low</option>
                                <option value="mid" selected>Mid</option>
                                <option value="high">High</option>
                                <option value="custom">Custom</option>
                            </select>
                            <div class="video-control-desc">Quick preset configurations for performance</div>
                        </div>

                        <!-- Antialiasing Control -->
                        <div class="video-control-item">
                            <div class="video-control-header">
                                <span class="video-control-label">Antialiasing</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggle-antialiasing" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="video-control-desc">Smooths jagged edges (may impact performance)</div>
                        </div>

                        <!-- Bloom Effect Control -->
                        <div class="video-control-item">
                            <div class="video-control-header">
                                <span class="video-control-label">Bloom Effect</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggle-bloom" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="volume-slider-container">
                                <div class="volume-slider" id="bloom-intensity-slider">
                                    <div class="volume-slider-track">
                                        <div class="volume-slider-fill" id="bloom-intensity-fill"></div>
                                        <div class="volume-slider-handle" id="bloom-intensity-handle"></div>
                                    </div>
                                </div>
                                <span class="volume-percentage" id="bloom-intensity-percentage">70%</span>
                            </div>
                        </div>

                        <!-- Fog Control -->
                        <div class="video-control-item">
                            <div class="video-control-header">
                                <span class="video-control-label">Fog</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggle-fog" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="video-control-desc">Atmospheric distance fog</div>
                        </div>

                        <!-- Snow Particles Control -->
                        <div class="video-control-item">
                            <div class="video-control-header">
                                <span class="video-control-label">Snow Particles</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggle-snow" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="video-control-desc">Falling snow particles (performance impact)</div>
                        </div>

                        <!-- Leaves Particles Control -->
                        <div class="video-control-item">
                            <div class="video-control-header">
                                <span class="video-control-label">Leaves Particles</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggle-leaves" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="video-control-desc">Falling leaves particles (performance impact)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="news-reel">
            <div class="rgb-edge"></div>
            <div class="news-content">
                <span>‚ùÑÔ∏è LATEST UPDATE: Visuals improved ‚Ä¢ Snow intensity reduced ‚Ä¢ House windows updated ‚Ä¢ Welcome to
                    Voxel Christmas v0.0.1 ALPHA ‚ùÑÔ∏è</span>
            </div>
        </div>
        <p class="audio-warning">üéµ Background music enabled - adjust volume as needed</p>
    </div>

    <div id="countdown-timer" class="countdown-timer">5</div>

    <!-- Crosshair -->
    <div id="crosshair" class="crosshair-hidden">
        <div class="crosshair-line crosshair-horizontal"></div>
        <div class="crosshair-line crosshair-vertical"></div>
    </div>

    <!-- Pause Menu -->
    <div id="pause-menu" class="pause-menu-hidden">
        <div class="pause-menu-content">
            <h2>‚è∏Ô∏è Game Paused</h2>
            <div class="pause-menu-buttons">
                <button id="pause-resume-btn" class="pause-menu-btn">‚ñ∂ Resume</button>
                <button id="pause-settings-btn" class="pause-menu-btn">‚öôÔ∏è Settings</button>
                <button id="pause-quit-btn" class="pause-menu-btn">üö™ Quit to Menu</button>
            </div>
        </div>
    </div>

    <button id="ui-toggle" class="ui-btn">Hide UI</button>
    <button id="fullscreen-btn" class="ui-btn">‚õ∂ Fullscreen</button>
    <button id="quit-btn" class="ui-btn">‚úï Quit</button>

    <button id="tech-toggle-btn" class="tech-toggle-btn">‚öôÔ∏è Tech</button>
    <div id="tech-info-panel" class="tech-panel-hidden">
        <div class="tech-box" id="tech-threejs">
            <span class="tech-icon">üì¶</span>
            <div class="tech-content">
                <div class="tech-name">Three.js</div>
                <div class="tech-desc">v0.181.2</div>
            </div>
        </div>
        <div class="tech-box" id="tech-webgl">
            <span class="tech-icon">üé®</span>
            <div class="tech-content">
                <div class="tech-name">WebGL</div>
                <div class="tech-desc">Renderer</div>
            </div>
        </div>
        <div class="tech-box" id="tech-postprocessing">
            <span class="tech-icon">‚ú®</span>
            <div class="tech-content">
                <div class="tech-name">Post-Processing</div>
                <div class="tech-desc">Bloom Effects</div>
            </div>
        </div>
        <div class="tech-box" id="tech-instanced">
            <span class="tech-icon">‚ö°</span>
            <div class="tech-content">
                <div class="tech-name">Instanced Rendering</div>
                <div class="tech-desc">InstancedMesh</div>
            </div>
        </div>
        <div class="tech-box" id="tech-particles">
            <span class="tech-icon">‚ùÑÔ∏è</span>
            <div class="tech-content">
                <div class="tech-name">Particle Systems</div>
                <div class="tech-desc">THREE.Points</div>
            </div>
        </div>
        <div class="tech-box" id="tech-controls">
            <span class="tech-icon">üéÆ</span>
            <div class="tech-content">
                <div class="tech-name">OrbitControls</div>
                <div class="tech-desc">Camera Control</div>
            </div>
        </div>
    </div>

    <div id="loading">Generating World...</div>

    <!-- World Loading Screen -->
    <div id="world-loading-screen" class="world-loading-screen-hidden">
        <div class="loading-content">
            <div class="loading-header">
                <h2>üå≤ Generating World</h2>
            </div>
            <div class="loading-progress-container">
                <div class="loading-progress-bar">
                    <div class="loading-progress-fill" id="loading-progress-fill"></div>
                </div>
                <div class="loading-percentage" id="loading-percentage">0%</div>
            </div>
            <div class="loading-status" id="loading-status">Initializing world generation...</div>
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
        </div>
    </div>

    <!-- Background Music -->
    <audio id="bg-music" loop>
        <source src="assets/audio/Frozen Whispers.mp3" type="audio/mpeg">
    </audio>

    <script type="module" src="js/main.js"></script>
</body>

</html>